---
title: 【笔记】你不知道的JS(上)-1.作用域是什么
date: 2025-06-27 13:46:18
tags: JS
---

《你不知道的 JavaScript》（上卷）第 1 章《作用域是什么》主要围绕编程语言的核心概念——​​ 作用域 ​​ 展开，解释了其工作原理和关键角色。以下是核心内容的总结：

### 1. **编译原理与作用域**

- **代码执行的三个阶段**：
  1.  **分词/词法分析**：将代码字符串分解为有意义的词法单元（tokens）。
  2.  **解析/语法分析**：将词法单元转换为抽象语法树（AST）。
  3.  **代码生成**：将 AST 转换为可执行的机器指令。
- **JavaScript 的编译发生在执行前**（通常是微秒级），因此作用域规则在代码执行前就已确定。

---

### 2. **理解作用域**

- **作用域的本质**：一套规则，用于确定在何处以及如何查找变量（标识符）。
- **关键角色**：
  - **引擎**：负责编译和执行全过程。
  - **编译器**：处理语法分析和代码生成。
  - **作用域**：收集并维护变量查询规则，确定当前代码对变量的访问权限。

---

### 3. **LHS 与 RHS 查询**

- **LHS（Left-Hand Side）**：查找变量的容器（赋值操作的目标）。
  ```javascript
  a = 2; // 对a进行LHS查询
  ```
- **RHS（Right-Hand Side）**：查找变量的值（赋值操作的来源）。
  ```javascript
  console.log(a); // 对a进行RHS查询
  ```
- **区别**：LHS 关注“变量在哪儿”，RHS 关注“变量的值是什么”。

---

### 4. **作用域嵌套与遮蔽效应**

- **嵌套作用域**：当前作用域找不到变量时，会向外层作用域逐级查找（直到全局作用域）。
- **遮蔽效应**：内层作用域的变量会遮蔽外层同名变量。
  ```javascript
  var a = 1;
  function foo() {
    var a = 2; // 遮蔽了外层的a
  }
  ```

---

### 5. **异常处理**

- **RHS 查询失败**：抛出`ReferenceError`（变量未声明）。
- **LHS 查询失败（非严格模式）**：自动创建全局变量（严格模式下抛出`ReferenceError`）。

---

### 6. **词法作用域 vs 动态作用域**

- **词法作用域**（JavaScript 采用）：作用域由代码书写时的函数和块结构决定，编译阶段确定。
- **动态作用域**：作用域在运行时根据调用栈动态确定（如 Bash 脚本）。

---

### 关键结论

- 作用域是静态的（由代码结构决定），但变量查找过程通过 LHS/RHS 动态实现。
- 理解 LHS/RHS 有助于调试变量相关的错误（如`ReferenceError`）。
- 作用域链的嵌套机制是 JavaScript 闭包的基础。

这一章为后续理解闭包、`this`等高级概念奠定了基础。
