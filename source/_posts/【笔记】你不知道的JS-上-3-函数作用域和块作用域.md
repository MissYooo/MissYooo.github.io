---
title: 【笔记】你不知道的JS(上)-3.函数作用域和块作用域
date: 2025-06-29 10:39:18
tags: JS
---

《你不知道的 JavaScript》（上卷）第 3 章《函数作用域和块作用域》深入解析了 JavaScript 的函数作用域和块作用域，探讨变量可见性规则及其对代码设计的影响，并对比了 `var` 与 `let/const` 的作用域差异。

---

### **详细总结**

#### 1. **函数作用域（Function Scope）**

- **概念**：函数内声明的变量仅在该函数内部可见，外部无法访问。
- **特点**：
  - 函数内部的变量会遮蔽（Shadow）外部同名变量。
  - 函数参数也属于函数作用域的一部分。
- **优点**：
  - 避免全局命名冲突，实现封装性。
  - 通过 IIFE（立即执行函数表达式）创建独立作用域，例如：
    ```javascript
    (function () {
      var privateVar = "内部变量";
    })();
    ```

#### 2. **块作用域（Block Scope）**

- **传统局限**（ES5 及之前）：
  - `if`、`for` 等 `{}` 不隔离作用域，`var` 声明的变量会提升至函数或全局作用域。
  - 仅 `try/catch` 的 `catch` 分句具有块作用域特性。
- **ES6 改进**：
  - `let` 和 `const` 支持块级作用域，变量仅在 `{}` 内有效。
  - 解决循环变量泄露问题（如 `for (let i=0; ...)` 中的 `i` 仅在循环内有效）。
  - 暂时性死区（TDZ）：变量在声明前不可访问，避免变量提升的副作用。

#### 3. **作用域的应用与最佳实践**

- **最小暴露原则**：将变量限制在最小必要作用域内（如用 `let` 替代 `var`）。
- **避免全局污染**：优先使用块作用域或模块化（ES6 Module）替代 IIFE。
- **性能优化**：块作用域可能帮助垃圾回收更快释放变量内存。

#### 4. **关键对比**

| **特性**     | `var`      | `let` / `const`    |
| ------------ | ---------- | ------------------ |
| **作用域**   | 函数作用域 | 块作用域           |
| **变量提升** | 存在       | 不存在（TDZ 机制） |
| **循环变量** | 泄露到外部 | 仅在循环块内有效   |

#### 5. **总结**

- **函数作用域**：适用于封装逻辑，IIFE 在旧代码中常见，但现代开发中逐渐被模块化替代。
- **块作用域**：通过 `let/const` 实现更精确的变量控制，是 ES6 后的首选方案。
- **核心原则**：根据变量生命周期选择合适的作用域，减少命名冲突和意外行为。

---

**关联知识**：本章为第 4 章《提升》和第 5 章《闭包》奠定基础，后续章节会进一步探讨作用域链与闭包机制。
